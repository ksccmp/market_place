<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ssafy.edu.vue.dao.HrmMapper">
	<select id="findAllEmployees" resultType="emp">
		select * from s_emp order by #{id}
	</select>
	
	<insert id="addEmployee" parameterType="emp">
		insert into s_emp values (#{id}, #{name}, #{mailid}, str_to_date(#{start_date},'%Y-%m-%d'), #{manager_id}, #{title}, #{dept_id}, #{salary}, #{commission_pct})
	</insert>
	
	<delete id="deleteEmployee" parameterType="int">
		delete from s_emp where id = #{id}
	</delete>
	
	<select id="findAllDepartments" resultType="dept">
		select * from s_dept
	</select>
	
	<select id="findAllTitles" resultType="emp">
		select distinct title from s_emp;
	</select>
	
	<select id="findEmployeeById" parameterType="int" resultType="emp">
		select * from s_emp where id = #{id}
	</select>
	
	<select id="findLikeEmployees" parameterType="string" resultType="emp">
		select * from s_emp where name like concat('%', #{name}, '%') order by #{id}
	</select>
	
	<select id="getEmployeesTotal" resultType="int">
		select count(*) from s_emp;
	</select>
	
	<update id="updateEmployee" parameterType="emp">
		update s_emp set name=#{name}, mailid=#{mailid}, start_date=str_to_date(#{start_date},'%Y-%m-%d'), manager_id=#{manager_id}, title=#{title}, dept_id=#{dept_id}, salary=#{salary}, commission_pct=#{commission_pct}
		where id=#{id} 
	</update>
	
	<select id="findAllDepCounts" resultType="deptCnt">
		select dept_id, d.name as name, count(dept_id) as count from s_dept d join s_emp using(dept_id) group by dept_id; 
	</select>
	
	<select id="findAllDeptEmps" resultType="deptEmp">
		select e.id as eid, e.name as ename, e.mailid as emailid, dept_id as deptid, d.name as dname from s_emp e join s_dept d using(dept_id);
	</select>
	
	<select id="findDepartmentsBydeptid" resultType="emp">
		select * from s_emp where dept_id = #{dept_id}
	</select>
	
	<select id="findDepartmentsByname" parameterType="string" resultType="emp">
		select id, name, mailid, start_date, manager_id, title, dept_id, salary, commission_pct from s_emp where dept_id in (select dept_id from s_dept where name = #{name});
	</select>
	
	<select id="findEmployeesByManagerId" parameterType="int" resultType="emp">
		select * from s_emp where manager_id = #{manager_id}
	</select>
</mapper>